<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=UTF-8" />
<meta name="generator" content="AsciiDoc 8.6.4" />
<title>IPC interface (interprocess communication)</title>
<style type="text/css">
/* Sans-serif font. */
h1, h2, h3, h4, h5, h6,
div.title, caption.title,
thead, p.table.header,
div#toctitle,
span#author, span#revnumber, span#revdate, span#revremark,
div#footer {
  font-family: Arial,Helvetica,sans-serif;
}

/* Serif font. */
div.sectionbody {
  font-family: Georgia,"Times New Roman",Times,serif;
}

/* Monospace font. */
tt {
  font-size: inherit;
}

body {
  margin: 1em 5% 1em 5%;
}

a {
  color: blue;
  text-decoration: underline;
}
a:visited {
  color: fuchsia;
}

em {
  font-style: italic;
  color: navy;
}

strong {
  font-weight: bold;
  color: #083194;
}

tt {
  font-size: inherit;
  color: navy;
}

h1, h2, h3, h4, h5, h6 {
  color: #527bbd;
  margin-top: 1.2em;
  margin-bottom: 0.5em;
  line-height: 1.3;
}

h1, h2, h3 {
  border-bottom: 2px solid silver;
}
h2 {
  padding-top: 0.5em;
}
h3 {
  float: left;
}
h3 + * {
  clear: left;
}

div.sectionbody {
  margin-left: 0;
}

hr {
  border: 1px solid silver;
}

p {
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}

ul, ol, li > p {
  margin-top: 0;
}
ul > li     { color: #aaa; }
ul > li > * { color: black; }

pre {
  padding: 0;
  margin: 0;
}

span#author {
  color: #527bbd;
  font-weight: bold;
  font-size: 1.1em;
}
span#email {
}
span#revnumber, span#revdate, span#revremark {
}

div#footer {
  font-size: small;
  border-top: 2px solid silver;
  padding-top: 0.5em;
  margin-top: 4.0em;
}
div#footer-text {
  float: left;
  padding-bottom: 0.5em;
}
div#footer-badges {
  float: right;
  padding-bottom: 0.5em;
}

div#preamble {
  margin-top: 1.5em;
  margin-bottom: 1.5em;
}
div.tableblock, div.imageblock, div.exampleblock, div.verseblock,
div.quoteblock, div.literalblock, div.listingblock, div.sidebarblock,
div.admonitionblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.admonitionblock {
  margin-top: 2.0em;
  margin-bottom: 2.0em;
  margin-right: 10%;
  color: #606060;
}

div.content { /* Block element content. */
  padding: 0;
}

/* Block element titles. */
div.title, caption.title {
  color: #527bbd;
  font-weight: bold;
  text-align: left;
  margin-top: 1.0em;
  margin-bottom: 0.5em;
}
div.title + * {
  margin-top: 0;
}

td div.title:first-child {
  margin-top: 0.0em;
}
div.content div.title:first-child {
  margin-top: 0.0em;
}
div.content + div.title {
  margin-top: 0.0em;
}

div.sidebarblock > div.content {
  background: #ffffee;
  border: 1px solid #dddddd;
  border-left: 4px solid #f0f0f0;
  padding: 0.5em;
}

div.listingblock > div.content {
  border: 1px solid #dddddd;
  border-left: 5px solid #f0f0f0;
  background: #f8f8f8;
  padding: 0.5em;
}

div.quoteblock, div.verseblock {
  padding-left: 1.0em;
  margin-left: 1.0em;
  margin-right: 10%;
  border-left: 5px solid #f0f0f0;
  color: #777777;
}

div.quoteblock > div.attribution {
  padding-top: 0.5em;
  text-align: right;
}

div.verseblock > pre.content {
  font-family: inherit;
  font-size: inherit;
}
div.verseblock > div.attribution {
  padding-top: 0.75em;
  text-align: left;
}
/* DEPRECATED: Pre version 8.2.7 verse style literal block. */
div.verseblock + div.attribution {
  text-align: left;
}

div.admonitionblock .icon {
  vertical-align: top;
  font-size: 1.1em;
  font-weight: bold;
  text-decoration: underline;
  color: #527bbd;
  padding-right: 0.5em;
}
div.admonitionblock td.content {
  padding-left: 0.5em;
  border-left: 3px solid #dddddd;
}

div.exampleblock > div.content {
  border-left: 3px solid #dddddd;
  padding-left: 0.5em;
}

div.imageblock div.content { padding-left: 0; }
span.image img { border-style: none; }
a.image:visited { color: white; }

dl {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
dt {
  margin-top: 0.5em;
  margin-bottom: 0;
  font-style: normal;
  color: navy;
}
dd > *:first-child {
  margin-top: 0.1em;
}

ul, ol {
    list-style-position: outside;
}
ol.arabic {
  list-style-type: decimal;
}
ol.loweralpha {
  list-style-type: lower-alpha;
}
ol.upperalpha {
  list-style-type: upper-alpha;
}
ol.lowerroman {
  list-style-type: lower-roman;
}
ol.upperroman {
  list-style-type: upper-roman;
}

div.compact ul, div.compact ol,
div.compact p, div.compact p,
div.compact div, div.compact div {
  margin-top: 0.1em;
  margin-bottom: 0.1em;
}

div.tableblock > table {
  border: 3px solid #527bbd;
}
thead, p.table.header {
  font-weight: bold;
  color: #527bbd;
}
tfoot {
  font-weight: bold;
}
td > div.verse {
  white-space: pre;
}
p.table {
  margin-top: 0;
}
/* Because the table frame attribute is overriden by CSS in most browsers. */
div.tableblock > table[frame="void"] {
  border-style: none;
}
div.tableblock > table[frame="hsides"] {
  border-left-style: none;
  border-right-style: none;
}
div.tableblock > table[frame="vsides"] {
  border-top-style: none;
  border-bottom-style: none;
}


div.hdlist {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
div.hdlist tr {
  padding-bottom: 15px;
}
dt.hdlist1.strong, td.hdlist1.strong {
  font-weight: bold;
}
td.hdlist1 {
  vertical-align: top;
  font-style: normal;
  padding-right: 0.8em;
  color: navy;
}
td.hdlist2 {
  vertical-align: top;
}
div.hdlist.compact tr {
  margin: 0;
  padding-bottom: 0;
}

.comment {
  background: yellow;
}

.footnote, .footnoteref {
  font-size: 0.8em;
}

span.footnote, span.footnoteref {
  vertical-align: super;
}

#footnotes {
  margin: 20px 0 20px 0;
  padding: 7px 0 0 0;
}

#footnotes div.footnote {
  margin: 0 0 5px 0;
}

#footnotes hr {
  border: none;
  border-top: 1px solid silver;
  height: 1px;
  text-align: left;
  margin-left: 0;
  width: 20%;
  min-width: 100px;
}

div.colist td {
  padding-right: 0.5em;
  padding-bottom: 0.3em;
  vertical-align: top;
}
div.colist td img {
  margin-top: 0.3em;
}

@media print {
  div#footer-badges { display: none; }
}

div#toc {
  margin-bottom: 2.5em;
}

div#toctitle {
  color: #527bbd;
  font-size: 1.1em;
  font-weight: bold;
  margin-top: 1.0em;
  margin-bottom: 0.1em;
}

div.toclevel1, div.toclevel2, div.toclevel3, div.toclevel4 {
  margin-top: 0;
  margin-bottom: 0;
}
div.toclevel2 {
  margin-left: 2em;
  font-size: 0.9em;
}
div.toclevel3 {
  margin-left: 4em;
  font-size: 0.9em;
}
div.toclevel4 {
  margin-left: 6em;
  font-size: 0.9em;
}

span.aqua { color: aqua; }
span.black { color: black; }
span.blue { color: blue; }
span.fuchsia { color: fuchsia; }
span.gray { color: gray; }
span.green { color: green; }
span.lime { color: lime; }
span.maroon { color: maroon; }
span.navy { color: navy; }
span.olive { color: olive; }
span.purple { color: purple; }
span.red { color: red; }
span.silver { color: silver; }
span.teal { color: teal; }
span.white { color: white; }
span.yellow { color: yellow; }

span.aqua-background { background: aqua; }
span.black-background { background: black; }
span.blue-background { background: blue; }
span.fuchsia-background { background: fuchsia; }
span.gray-background { background: gray; }
span.green-background { background: green; }
span.lime-background { background: lime; }
span.maroon-background { background: maroon; }
span.navy-background { background: navy; }
span.olive-background { background: olive; }
span.purple-background { background: purple; }
span.red-background { background: red; }
span.silver-background { background: silver; }
span.teal-background { background: teal; }
span.white-background { background: white; }
span.yellow-background { background: yellow; }

span.big { font-size: 2em; }
span.small { font-size: 0.6em; }
</style>
<script type="text/javascript">
/*<![CDATA[*/
window.onload = function(){asciidoc.footnotes(); asciidoc.toc(2);}
var asciidoc = {  // Namespace.

/////////////////////////////////////////////////////////////////////
// Table Of Contents generator
/////////////////////////////////////////////////////////////////////

/* Author: Mihai Bazon, September 2002
 * http://students.infoiasi.ro/~mishoo
 *
 * Table Of Content generator
 * Version: 0.4
 *
 * Feel free to use this script under the terms of the GNU General Public
 * License, as long as you do not remove or alter this notice.
 */

 /* modified by Troy D. Hanson, September 2006. License: GPL */
 /* modified by Stuart Rackham, 2006, 2009. License: GPL */

// toclevels = 1..4.
toc: function (toclevels) {

  function getText(el) {
    var text = "";
    for (var i = el.firstChild; i != null; i = i.nextSibling) {
      if (i.nodeType == 3 /* Node.TEXT_NODE */) // IE doesn't speak constants.
        text += i.data;
      else if (i.firstChild != null)
        text += getText(i);
    }
    return text;
  }

  function TocEntry(el, text, toclevel) {
    this.element = el;
    this.text = text;
    this.toclevel = toclevel;
  }

  function tocEntries(el, toclevels) {
    var result = new Array;
    var re = new RegExp('[hH]([2-'+(toclevels+1)+'])');
    // Function that scans the DOM tree for header elements (the DOM2
    // nodeIterator API would be a better technique but not supported by all
    // browsers).
    var iterate = function (el) {
      for (var i = el.firstChild; i != null; i = i.nextSibling) {
        if (i.nodeType == 1 /* Node.ELEMENT_NODE */) {
          var mo = re.exec(i.tagName);
          if (mo && (i.getAttribute("class") || i.getAttribute("className")) != "float") {
            result[result.length] = new TocEntry(i, getText(i), mo[1]-1);
          }
          iterate(i);
        }
      }
    }
    iterate(el);
    return result;
  }

  var toc = document.getElementById("toc");
  var entries = tocEntries(document.getElementById("content"), toclevels);
  for (var i = 0; i < entries.length; ++i) {
    var entry = entries[i];
    if (entry.element.id == "")
      entry.element.id = "_toc_" + i;
    var a = document.createElement("a");
    a.href = "#" + entry.element.id;
    a.appendChild(document.createTextNode(entry.text));
    var div = document.createElement("div");
    div.appendChild(a);
    div.className = "toclevel" + entry.toclevel;
    toc.appendChild(div);
  }
  if (entries.length == 0)
    toc.parentNode.removeChild(toc);
},


/////////////////////////////////////////////////////////////////////
// Footnotes generator
/////////////////////////////////////////////////////////////////////

/* Based on footnote generation code from:
 * http://www.brandspankingnew.net/archive/2005/07/format_footnote.html
 */

footnotes: function () {
  var cont = document.getElementById("content");
  var noteholder = document.getElementById("footnotes");
  var spans = cont.getElementsByTagName("span");
  var refs = {};
  var n = 0;
  for (i=0; i<spans.length; i++) {
    if (spans[i].className == "footnote") {
      n++;
      // Use [\s\S] in place of . so multi-line matches work.
      // Because JavaScript has no s (dotall) regex flag.
      note = spans[i].innerHTML.match(/\s*\[([\s\S]*)]\s*/)[1];
      noteholder.innerHTML +=
        "<div class='footnote' id='_footnote_" + n + "'>" +
        "<a href='#_footnoteref_" + n + "' title='Return to text'>" +
        n + "</a>. " + note + "</div>";
      spans[i].innerHTML =
        "[<a id='_footnoteref_" + n + "' href='#_footnote_" + n +
        "' title='View footnote' class='footnote'>" + n + "</a>]";
      var id =spans[i].getAttribute("id");
      if (id != null) refs["#"+id] = n;
    }
  }
  if (n == 0)
    noteholder.parentNode.removeChild(noteholder);
  else {
    // Process footnoterefs.
    for (i=0; i<spans.length; i++) {
      if (spans[i].className == "footnoteref") {
        var href = spans[i].getElementsByTagName("a")[0].getAttribute("href");
        href = href.match(/#.*/)[0];  // Because IE return full URL.
        n = refs[href];
        spans[i].innerHTML =
          "[<a href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
      }
    }
  }
}

}
/*]]>*/
</script>
</head>
<body class="article">
<div id="header">
<h1>IPC interface (interprocess communication)</h1>
<span id="author">Michael Stapelberg</span><br />
<span id="email"><tt>&lt;<a href="mailto:michael+i3@stapelberg.de">michael+i3@stapelberg.de</a>&gt;</tt></span><br />
<span id="revdate">October 2011</span>
<div id="toc">
  <div id="toctitle">Table of Contents</div>
  <noscript><p><b>JavaScript must be enabled in your browser to display the table of contents.</b></p></noscript>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph"><p>This document describes how to interface with i3 from a separate process. This
is useful for example to remote-control i3 (to write test cases for example) or
to get various information like the current workspaces to implement an external
workspace bar.</p></div>
<div class="paragraph"><p>The method of choice for IPC in our case is a unix socket because it has very
little overhead on both sides and is usually available without headaches in
most languages. In the default configuration file, the ipc-socket gets created
in <tt>/tmp/i3-%u/ipc-socket.%p</tt> where <tt>%u</tt> is your UNIX username and <tt>%p</tt> is the
PID of i3. You can get the socketpath from i3 by calling <tt>i3 --get-socketpath</tt>.</p></div>
<div class="paragraph"><p>All i3 utilities, like <tt>i3-msg</tt> and <tt>i3-input</tt> will read the <tt>I3_SOCKET_PATH</tt>
X11 property, stored on the X11 root window.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_establishing_a_connection">1. Establishing a connection</h2>
<div class="sectionbody">
<div class="paragraph"><p>To establish a connection, simply open the IPC socket. The following code
snippet illustrates this in Perl:</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>use IO::Socket::UNIX;
chomp(my $path = qx(i3 --get-socketpath));
my $sock = IO::Socket::UNIX-&gt;new(Peer =&gt; $path);</tt></pre>
</div></div>
</div>
</div>
<div class="sect1">
<h2 id="_sending_messages_to_i3">2. Sending messages to i3</h2>
<div class="sectionbody">
<div class="paragraph"><p>To send a message to i3, you have to format in the binary message format which
i3 expects. This format specifies a magic string in the beginning to ensure
the integrity of messages (to prevent follow-up errors). Following the magic
string comes the length of the payload of the message as 32-bit integer, and
the type of the message as 32-bit integer (the integers are not converted, so
they are in native byte order).</p></div>
<div class="paragraph"><p>The magic string currently is "i3-ipc" and will only be changed when a change
in the IPC API is done which breaks compatibility (we hope that we don’t need
to do that).</p></div>
<div class="paragraph"><p>Currently implemented message types are the following:</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
COMMAND (0)
</dt>
<dd>
<p>
        The payload of the message is a command for i3 (like the commands you
        can bind to keys in the configuration file) and will be executed
        directly after receiving it. There is no reply to this message.
</p>
</dd>
<dt class="hdlist1">
GET_WORKSPACES (1)
</dt>
<dd>
<p>
        Gets the current workspaces. The reply will be a JSON-encoded list of
        workspaces (see the reply section).
</p>
</dd>
<dt class="hdlist1">
SUBSCRIBE (2)
</dt>
<dd>
<p>
        Subscribes your connection to certain events. See <a href="#events">[events]</a> for a
        description of this message and the concept of events.
</p>
</dd>
<dt class="hdlist1">
GET_OUTPUTS (3)
</dt>
<dd>
<p>
        Gets the current outputs. The reply will be a JSON-encoded list of outputs
        (see the reply section).
</p>
</dd>
<dt class="hdlist1">
GET_TREE (4)
</dt>
<dd>
<p>
        Gets the layout tree. i3 uses a tree as data structure which includes
        every container. The reply will be the JSON-encoded tree (see the reply
        section).
</p>
</dd>
<dt class="hdlist1">
GET_MARKS (5)
</dt>
<dd>
<p>
        Gets a list of marks (identifiers for containers to easily jump to them
        later). The reply will be a JSON-encoded list of window marks (see
        reply section).
</p>
</dd>
<dt class="hdlist1">
GET_BAR_CONFIG (6)
</dt>
<dd>
<p>
        Gets the configuration (as JSON map) of the workspace bar with the
        given ID. If no ID is provided, an array with all configured bar IDs is
        returned instead.
</p>
</dd>
</dl></div>
<div class="paragraph"><p>So, a typical message could look like this:</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>"i3-ipc" &lt;message length&gt; &lt;message type&gt; &lt;payload&gt;</tt></pre>
</div></div>
<div class="paragraph"><p>Or, as a hexdump:</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>00000000  69 33 2d 69 70 63 04 00  00 00 00 00 00 00 65 78  |i3-ipc........ex|
00000010  69 74 0a                                          |it.|</tt></pre>
</div></div>
<div class="paragraph"><p>To generate and send such a message, you could use the following code in Perl:</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>sub format_ipc_command {
    my ($msg) = @_;
    my $len;
    # Get the real byte count (vs. amount of characters)
    { use bytes; $len = length($msg); }
    return "i3-ipc" . pack("LL", $len, 0) . $msg;
}

$sock-&gt;write(format_ipc_command("exit"));</tt></pre>
</div></div>
</div>
</div>
<div class="sect1">
<h2 id="_receiving_replies_from_i3">3. Receiving replies from i3</h2>
<div class="sectionbody">
<div class="paragraph"><p>Replies from i3 usually consist of a simple string (the length of the string
is the message_length, so you can consider them length-prefixed) which in turn
contain the JSON serialization of a data structure. For example, the
GET_WORKSPACES message returns an array of workspaces (each workspace is a map
with certain attributes).</p></div>
<div class="sect2">
<h3 id="_reply_format">3.1. Reply format</h3>
<div class="paragraph"><p>The reply format is identical to the normal message format. There also is
the magic string, then the message length, then the message type and the
payload.</p></div>
<div class="paragraph"><p>The following reply types are implemented:</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
COMMAND (0)
</dt>
<dd>
<p>
        Confirmation/Error code for the COMMAND message.
</p>
</dd>
<dt class="hdlist1">
GET_WORKSPACES (1)
</dt>
<dd>
<p>
        Reply to the GET_WORKSPACES message.
</p>
</dd>
<dt class="hdlist1">
SUBSCRIBE (2)
</dt>
<dd>
<p>
        Confirmation/Error code for the SUBSCRIBE message.
</p>
</dd>
<dt class="hdlist1">
GET_OUTPUTS (3)
</dt>
<dd>
<p>
        Reply to the GET_OUTPUTS message.
</p>
</dd>
<dt class="hdlist1">
GET_TREE (4)
</dt>
<dd>
<p>
        Reply to the GET_TREE message.
</p>
</dd>
<dt class="hdlist1">
GET_MARKS (5)
</dt>
<dd>
<p>
        Reply to the GET_MARKS message.
</p>
</dd>
<dt class="hdlist1">
GET_BAR_CONFIG (6)
</dt>
<dd>
<p>
        Reply to the GET_BAR_CONFIG message.
</p>
</dd>
</dl></div>
</div>
<div class="sect2">
<h3 id="_command_reply">3.2. COMMAND reply</h3>
<div class="paragraph"><p>The reply consists of a single serialized map. At the moment, the only
property is <tt>success (bool)</tt>, but this will be expanded in future versions.</p></div>
<div class="paragraph"><p><strong>Example:</strong></p></div>
<div class="listingblock">
<div class="content">
<pre><tt>{ "success": true }</tt></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_get_workspaces_reply">3.3. GET_WORKSPACES reply</h3>
<div class="paragraph"><p>The reply consists of a serialized list of workspaces. Each workspace has the
following properties:</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
num (integer)
</dt>
<dd>
<p>
        The logical number of the workspace. Corresponds to the command
        to switch to this workspace.
</p>
</dd>
<dt class="hdlist1">
name (string)
</dt>
<dd>
<p>
        The name of this workspace (by default num+1), as changed by the
        user. Encoded in UTF-8.
</p>
</dd>
<dt class="hdlist1">
visible (boolean)
</dt>
<dd>
<p>
        Whether this workspace is currently visible on an output (multiple
        workspaces can be visible at the same time).
</p>
</dd>
<dt class="hdlist1">
focused (boolean)
</dt>
<dd>
<p>
        Whether this workspace currently has the focus (only one workspace
        can have the focus at the same time).
</p>
</dd>
<dt class="hdlist1">
urgent (boolean)
</dt>
<dd>
<p>
        Whether a window on this workspace has the "urgent" flag set.
</p>
</dd>
<dt class="hdlist1">
rect (map)
</dt>
<dd>
<p>
        The rectangle of this workspace (equals the rect of the output it
        is on), consists of x, y, width, height.
</p>
</dd>
<dt class="hdlist1">
output (string)
</dt>
<dd>
<p>
        The video output this workspace is on (LVDS1, VGA1, …).
</p>
</dd>
</dl></div>
<div class="paragraph"><p><strong>Example:</strong></p></div>
<div class="listingblock">
<div class="content">
<pre><tt>[
 {
  "num": 0,
  "name": "1",
  "visible": true,
  "focused": true,
  "urgent": false,
  "rect": {
   "x": 0,
   "y": 0,
   "width": 1280,
   "height": 800
  },
  "output": "LVDS1"
 },
 {
  "num": 1,
  "name": "2",
  "visible": false,
  "focused": false,
  "urgent": false,
  "rect": {
   "x": 0,
   "y": 0,
   "width": 1280,
   "height": 800
  },
  "output": "LVDS1"
 }
]</tt></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_subscribe_reply">3.4. SUBSCRIBE reply</h3>
<div class="paragraph"><p>The reply consists of a single serialized map. The only property is
<tt>success (bool)</tt>, indicating whether the subscription was successful (the
default) or whether a JSON parse error occurred.</p></div>
<div class="paragraph"><p><strong>Example:</strong></p></div>
<div class="listingblock">
<div class="content">
<pre><tt>{ "success": true }</tt></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_get_outputs_reply">3.5. GET_OUTPUTS reply</h3>
<div class="paragraph"><p>The reply consists of a serialized list of outputs. Each output has the
following properties:</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
name (string)
</dt>
<dd>
<p>
        The name of this output (as seen in <tt>xrandr(1)</tt>). Encoded in UTF-8.
</p>
</dd>
<dt class="hdlist1">
active (boolean)
</dt>
<dd>
<p>
        Whether this output is currently active (has a valid mode).
</p>
</dd>
<dt class="hdlist1">
current_workspace (integer)
</dt>
<dd>
<p>
        The current workspace which is visible on this output. <tt>null</tt> if the
        output is not active.
</p>
</dd>
<dt class="hdlist1">
rect (map)
</dt>
<dd>
<p>
        The rectangle of this output (equals the rect of the output it
        is on), consists of x, y, width, height.
</p>
</dd>
</dl></div>
<div class="paragraph"><p><strong>Example:</strong></p></div>
<div class="listingblock">
<div class="content">
<pre><tt>[
 {
  "name": "LVDS1",
  "active": true,
  "current_workspace": 4,
  "rect": {
   "x": 0,
   "y": 0,
   "width": 1280,
   "height": 800
  }
 },
 {
  "name": "VGA1",
  "active": true,
  "current_workspace": 1,
  "rect": {
   "x": 1280,
   "y": 0,
   "width": 1280,
   "height": 1024
  },
 }
]</tt></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_get_tree_reply">3.6. GET_TREE reply</h3>
<div class="paragraph"><p>The reply consists of a serialized tree. Each node in the tree (representing
one container) has at least the properties listed below. While the nodes might
have more properties, please do not use any properties which are not documented
here. They are not yet finalized and will probably change!</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
id (integer)
</dt>
<dd>
<p>
        The internal ID (actually a C pointer value) of this container. Do not
        make any assumptions about it. You can use it to (re-)identify and
        address containers when talking to i3.
</p>
</dd>
<dt class="hdlist1">
name (string)
</dt>
<dd>
<p>
        The internal name of this container. For all containers which are part
        of the tree structure down to the workspace contents, this is set to a
        nice human-readable name of the container.
        For all other containers, the content is not defined (yet).
</p>
</dd>
<dt class="hdlist1">
border (string)
</dt>
<dd>
<p>
        Can be either "normal", "none" or "1pixel", dependending on the
        container’s border style.
</p>
</dd>
<dt class="hdlist1">
layout (string)
</dt>
<dd>
<p>
        Can be either "default", "stacked", "tabbed", "dockarea" or "output".
        Other values might be possible in the future, should we add new
        layouts.
</p>
</dd>
<dt class="hdlist1">
orientation (string)
</dt>
<dd>
<p>
        Can be either "none" (for non-split containers), "horizontal" or
        "vertical".
</p>
</dd>
<dt class="hdlist1">
percent (float)
</dt>
<dd>
<p>
        The percentage which this container takes in its parent. A value of
        <tt>null</tt> means that the percent property does not make sense for this
        container, for example for the root container.
</p>
</dd>
<dt class="hdlist1">
rect (map)
</dt>
<dd>
<p>
        The absolute display coordinates for this container. Display
        coordinates means that when you have two 1600x1200 monitors on a single
        X11 Display (the standard way), the coordinates of the first window on
        the second monitor are <tt>{ "x": 1600, "y": 0, "width": 1600, "height":
        1200 }</tt>.
</p>
</dd>
<dt class="hdlist1">
window_rect (map)
</dt>
<dd>
<p>
        The coordinates of the <strong>actual client window</strong> inside its container.
        These coordinates are relative to the container and do not include the
        window decoration (which is actually rendered on the parent container).
        So, when using the <tt>default</tt> layout, you will have a 2 pixel border on
        each side, making the window_rect <tt>{ "x": 2, "y": 0, "width": 632,
        "height": 366 }</tt> (for example).
</p>
</dd>
<dt class="hdlist1">
geometry (map)
</dt>
<dd>
<p>
        The original geometry the window specified when i3 mapped it. Used when
        switching a window to floating mode, for example.
</p>
</dd>
<dt class="hdlist1">
urgent (bool)
</dt>
<dd>
<p>
        Whether this container (window or workspace) has the urgency hint set.
</p>
</dd>
<dt class="hdlist1">
focused (bool)
</dt>
<dd>
<p>
        Whether this container is currently focused.
</p>
</dd>
</dl></div>
<div class="paragraph"><p>Please note that in the following example, I have left out some keys/values
which are not relevant for the type of the node. Otherwise, the example would
be by far too long (it already is quite long, despite showing only 1 window and
one dock window).</p></div>
<div class="paragraph"><p>It is useful to have an overview of the structure before taking a look at the
JSON dump:</p></div>
<div class="ulist"><ul>
<li>
<p>
root
</p>
<div class="ulist"><ul>
<li>
<p>
LVDS1
</p>
<div class="ulist"><ul>
<li>
<p>
topdock
</p>
</li>
<li>
<p>
content
</p>
<div class="ulist"><ul>
<li>
<p>
workspace 1
</p>
<div class="ulist"><ul>
<li>
<p>
window 1
</p>
</li>
</ul></div>
</li>
</ul></div>
</li>
<li>
<p>
bottomdock
</p>
<div class="ulist"><ul>
<li>
<p>
dock window 1
</p>
</li>
</ul></div>
</li>
</ul></div>
</li>
<li>
<p>
VGA1
</p>
</li>
</ul></div>
</li>
</ul></div>
<div class="paragraph"><p><strong>Example:</strong></p></div>
<div class="listingblock">
<div class="content">
<pre><tt>{
 "id": 6875648,
 "name": "root",
 "rect": {
   "x": 0,
   "y": 0,
   "width": 1280,
   "height": 800
 },
 "nodes": [

   {
    "id": 6878320,
    "name": "LVDS1",
    "layout": "output",
    "rect": {
      "x": 0,
      "y": 0,
      "width": 1280,
      "height": 800
    },
    "nodes": [

      {
       "id": 6878784,
       "name": "topdock",
       "layout": "dockarea",
       "orientation": "vertical",
       "rect": {
         "x": 0,
         "y": 0,
         "width": 1280,
         "height": 0
       },
      },

      {
       "id": 6879344,
       "name": "content",
       "rect": {
         "x": 0,
         "y": 0,
         "width": 1280,
         "height": 782
       },
       "nodes": [

         {
          "id": 6880464,
          "name": "1",
          "orientation": "horizontal",
          "rect": {
            "x": 0,
            "y": 0,
            "width": 1280,
            "height": 782
          },
          "floating_nodes": [],
          "nodes": [

            {
             "id": 6929968,
             "name": "#aa0000",
             "border": "normal",
             "percent": 1,
             "rect": {
               "x": 0,
               "y": 18,
               "width": 1280,
               "height": 782
             }
            }

          ]
         }

       ]
      },

      {
       "id": 6880208,
       "name": "bottomdock",
       "layout": "dockarea",
       "orientation": "vertical",
       "rect": {
         "x": 0,
         "y": 782,
         "width": 1280,
         "height": 18
       },
       "nodes": [

         {
          "id": 6931312,
          "name": "#00aa00",
          "percent": 1,
          "rect": {
            "x": 0,
            "y": 782,
            "width": 1280,
            "height": 18
          }
         }

       ]
      }
    ]
   }
 ]
}</tt></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_get_marks_reply">3.7. GET_MARKS reply</h3>
<div class="paragraph"><p>The reply consists of a single array of strings for each container that has a
mark. The order of that array is undefined. If more than one container has the
same mark, it will be represented multiple times in the reply (the array
contents are not unique).</p></div>
<div class="paragraph"><p>If no window has a mark the response will be the empty array [].</p></div>
</div>
<div class="sect2">
<h3 id="_get_bar_config_reply">3.8. GET_BAR_CONFIG reply</h3>
<div class="paragraph"><p>This can be used by third-party workspace bars (especially i3bar, but others
are free to implement compatible alternatives) to get the <tt>bar</tt> block
configuration from i3.</p></div>
<div class="paragraph"><p>Depending on the input, the reply is either:</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
empty input
</dt>
<dd>
<p>
        An array of configured bar IDs
</p>
</dd>
<dt class="hdlist1">
Bar ID
</dt>
<dd>
<p>
        A JSON map containing the configuration for the specified bar.
</p>
</dd>
</dl></div>
<div class="paragraph"><p>Each bar configuration has the following properties:</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
id (string)
</dt>
<dd>
<p>
        The ID for this bar. Included in case you request multiple
        configurations and want to differentiate the different replies.
</p>
</dd>
<dt class="hdlist1">
mode (string)
</dt>
<dd>
<p>
        Either <tt>dock</tt> (the bar sets the dock window type) or <tt>hide</tt> (the bar
        does not show unless a specific key is pressed).
</p>
</dd>
<dt class="hdlist1">
position (string)
</dt>
<dd>
<p>
        Either <tt>bottom</tt> or <tt>top</tt> at the moment.
</p>
</dd>
<dt class="hdlist1">
status_command (string)
</dt>
<dd>
<p>
        Command which will be run to generate a statusline. Each line on stdout
        of this command will be displayed in the bar. At the moment, no
        formatting is supported.
</p>
</dd>
<dt class="hdlist1">
font (string)
</dt>
<dd>
<p>
        The font to use for text on the bar.
</p>
</dd>
<dt class="hdlist1">
workspace_buttons (boolean)
</dt>
<dd>
<p>
        Display workspace buttons or not? Defaults to true.
</p>
</dd>
<dt class="hdlist1">
verbose (boolean)
</dt>
<dd>
<p>
        Should the bar enable verbose output for debugging? Defaults to false.
</p>
</dd>
<dt class="hdlist1">
colors (map)
</dt>
<dd>
<p>
        Contains key/value pairs of colors. Each value is a color code in hex,
        formatted #rrggbb (like in HTML).
</p>
</dd>
</dl></div>
<div class="paragraph"><p>The following colors can be configured at the moment:</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
background
</dt>
<dd>
<p>
        Background color of the bar.
</p>
</dd>
<dt class="hdlist1">
statusline
</dt>
<dd>
<p>
        Text color to be used for the statusline.
</p>
</dd>
<dt class="hdlist1">
focused_workspace_text/focused_workspace_bg
</dt>
<dd>
<p>
        Text color/background color for a workspace button when the workspace
        has focus.
</p>
</dd>
<dt class="hdlist1">
active_workspace_text/active_workspace_bg
</dt>
<dd>
<p>
        Text color/background color for a workspace button when the workspace
        is active (visible) on some output, but the focus is on another one.
        You can only tell this apart from the focused workspace when you are
        using multiple monitors.
</p>
</dd>
<dt class="hdlist1">
inactive_workspace_text/inactive_workspace_bg
</dt>
<dd>
<p>
        Text color/background color for a workspace button when the workspace
        does not have focus and is not active (visible) on any output. This
        will be the case for most workspaces.
</p>
</dd>
<dt class="hdlist1">
urgent_workspace_text/urgent_workspace_bar
</dt>
<dd>
<p>
        Text color/background color for workspaces which contain at least one
        window with the urgency hint set.
</p>
</dd>
</dl></div>
<div class="paragraph"><p><strong>Example of configured bars:</strong></p></div>
<div class="listingblock">
<div class="content">
<pre><tt>["bar-bxuqzf"]</tt></pre>
</div></div>
<div class="paragraph"><p><strong>Example of bar configuration:</strong></p></div>
<div class="listingblock">
<div class="content">
<pre><tt>{
 "id": "bar-bxuqzf",
 "mode": "dock",
 "position": "bottom",
 "status_command": "i3status",
 "font": "-misc-fixed-medium-r-normal--13-120-75-75-C-70-iso10646-1",
 "workspace_buttons": true,
 "verbose": false,
 "colors": {
   "background": "#c0c0c0",
   "statusline": "#00ff00",
   "focused_workspace_text": "#ffffff",
   "focused_workspace_bg": "#000000"
 }
}</tt></pre>
</div></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_events">4. Events</h2>
<div class="sectionbody">
<div class="paragraph" id="events"><p>To get informed when certain things happen in i3, clients can subscribe to
events. Events consist of a name (like "workspace") and an event reply type
(like I3_IPC_EVENT_WORKSPACE). The events sent by i3 are in the same format
as replies to specific commands. However, the highest bit of the message type
is set to 1 to indicate that this is an event reply instead of a normal reply.</p></div>
<div class="paragraph"><p>Caveat: As soon as you subscribe to an event, it is not guaranteed any longer
that the requests to i3 are processed in order. This means, the following
situation can happen: You send a GET_WORKSPACES request but you receive a
"workspace" event before receiving the reply to GET_WORKSPACES. If your
program does not want to cope which such kinds of race conditions (an
event based library may not have a problem here), I suggest you create a
separate connection to receive events.</p></div>
<div class="sect2">
<h3 id="_subscribing_to_events">4.1. Subscribing to events</h3>
<div class="paragraph"><p>By sending a message of type SUBSCRIBE with a JSON-encoded array as payload
you can register to an event.</p></div>
<div class="paragraph"><p><strong>Example:</strong></p></div>
<div class="listingblock">
<div class="content">
<pre><tt>type: SUBSCRIBE
payload: [ "workspace", "focus" ]</tt></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_available_events">4.2. Available events</h3>
<div class="paragraph"><p>The numbers in parenthesis is the event type (keep in mind that you need to
strip the highest bit first).</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
workspace (0)
</dt>
<dd>
<p>
        Sent when the user switches to a different workspace, when a new
        workspace is initialized or when a workspace is removed (because the
        last client vanished).
</p>
</dd>
<dt class="hdlist1">
output (1)
</dt>
<dd>
<p>
        Sent when RandR issues a change notification (of either screens,
        outputs, CRTCs or output properties).
</p>
</dd>
</dl></div>
<div class="paragraph"><p><strong>Example:</strong></p></div>
<div class="listingblock">
<div class="content">
<pre><tt># the appropriate 4 bytes read from the socket are stored in $input

# unpack a 32-bit unsigned integer
my $message_type = unpack("L", $input);

# check if the highest bit is 1
my $is_event = (($message_type &gt;&gt; 31) == 1);

# use the other bits
my $event_type = ($message_type &amp; 0x7F);

if ($is_event) {
  say "Received event of type $event_type";
}</tt></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_workspace_event">4.3. workspace event</h3>
<div class="paragraph"><p>This event consists of a single serialized map containing a property
<tt>change (string)</tt> which indicates the type of the change ("focus", "init",
"empty", "urgent").</p></div>
<div class="paragraph"><p><strong>Example:</strong></p></div>
<div class="listingblock">
<div class="content">
<pre><tt>{ "change": "focus" }</tt></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_output_event">4.4. output event</h3>
<div class="paragraph"><p>This event consists of a single serialized map containing a property
<tt>change (string)</tt> which indicates the type of the change (currently only
"unspecified").</p></div>
<div class="paragraph"><p><strong>Example:</strong></p></div>
<div class="listingblock">
<div class="content">
<pre><tt>{ "change": "unspecified" }</tt></pre>
</div></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_see_also">5. See also</h2>
<div class="sectionbody">
<div class="paragraph"><p>For some languages, libraries are available (so you don’t have to implement
all this on your own). This list names some (if you wrote one, please let me
know):</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
C
</dt>
<dd>
<p>
        i3 includes a headerfile <tt>i3/ipc.h</tt> which provides you all constants.
        However, there is no library yet.
</p>
</dd>
<dt class="hdlist1">
Ruby
</dt>
<dd>
<p>
        <a href="http://github.com/badboy/i3-ipc">http://github.com/badboy/i3-ipc</a>
</p>
</dd>
<dt class="hdlist1">
Perl
</dt>
<dd>
<p>
        <a href="http://search.cpan.org/search?query=AnyEvent::I3">http://search.cpan.org/search?query=AnyEvent::I3</a>
</p>
</dd>
<dt class="hdlist1">
Python
</dt>
<dd>
<p>
        <a href="http://github.com/thepub/i3ipc">http://github.com/thepub/i3ipc</a>
</p>
</dd>
</dl></div>
</div>
</div>
</div>
<div id="footnotes"><hr /></div>
<div id="footer">
<div id="footer-text">
Last updated 2011-10-23 17:46:59 IST
</div>
</div>
</body>
</html>
